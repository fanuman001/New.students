<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Billiard Glide 模擬器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; touch-action: none; }
        #canvas-container { width: 100vw; height: 60vh; position: relative; }
        .stats { font-family: sans-serif; }
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="w-full bg-slate-800 p-4 text-center shadow-lg">
        <h1 class="text-xl font-bold text-yellow-500">Billiard Glide 戰術模擬器</h1>
        <p class="text-xs text-slate-300">拖曳紅球模擬推球 | 目標：最接近右側黃線</p>
    </div>

    <div id="canvas-container" class="bg-green-900 border-y-8 border-amber-900"></div>

    <div class="flex-1 w-full bg-slate-900 p-4 stats text-white overflow-y-auto">
        <div id="winner-display" class="bg-blue-900/50 p-3 rounded-lg border border-blue-400 mb-3 text-center">
            正在偵測最接近底邊的球...
        </div>
        
        <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="bg-slate-800 p-2 rounded">
                <span class="text-red-400 font-bold">● A隊 (實色)</span>
                <p class="text-[10px]">進球: +25 | 底部: +75</p>
            </div>
            <div class="bg-slate-800 p-2 rounded">
                <span class="text-blue-400 font-bold">● B隊 (條紋)</span>
                <p class="text-[10px]">黑/母球進洞: +50 / +100</p>
            </div>
        </div>

        <button onclick="resetGame()" class="w-full mt-4 bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 rounded-full transition shadow-lg">
            重置場景
        </button>
    </div>

    <script>
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Events, Vector } = Matter;

        // 初始化物理引擎
        const engine = Engine.create();
        engine.gravity.y = 0; // 俯視圖不需要重力

        const container = document.getElementById('canvas-container');
        const render = Render.create({
            element: container,
            engine: engine,
            options: {
                width: container.clientWidth,
                height: container.clientHeight,
                wireframes: false,
                background: '#065f46'
            }
        });

        // 建立牆壁 (撞球桌邊)
        const wallOptions = { isStatic: true, render: { fillStyle: '#78350f' } };
        const ground = Bodies.rectangle(render.options.width/2, render.options.height + 10, render.options.width, 40, wallOptions);
        const ceiling = Bodies.rectangle(render.options.width/2, -10, render.options.width, 40, wallOptions);
        const leftWall = Bodies.rectangle(-10, render.options.height/2, 40, render.options.height, wallOptions);
        const rightWall = Bodies.rectangle(render.options.width + 10, render.options.height/2, 40, render.options.height, wallOptions);

        // 建立腳顆星底線標記
        const goalLine = render.options.width - 20;

        let balls = [];

        function createBall(x, y, color, label) {
            const ball = Bodies.circle(x, y, 12, {
                restitution: 0.8, // 彈性
                frictionAir: 0.03, // 空氣阻力(模擬桌面摩擦)
                render: { fillStyle: color }
            });
            ball.label = label;
            return ball;
        }

        function resetGame() {
            Composite.clear(engine.world);
            balls = [];
            
            // 加入牆壁
            Composite.add(engine.world, [ground, ceiling, leftWall, rightWall]);

            // 加入球員球 (示範用)
            const ballA = createBall(100, render.options.height/2 - 30, '#ef4444', 'A隊');
            const ballB = createBall(100, render.options.height/2 + 30, '#3b82f6', 'B隊');
            const blackBall = createBall(render.options.width - 60, render.options.height/2, '#000000', '黑球');
            const whiteBall = createBall(render.options.width - 60, render.options.height/2 - 50, '#ffffff', '母球');

            balls = [ballA, ballB, blackBall, whiteBall];
            Composite.add(engine.world, balls);
        }

        // 滑鼠/觸控控制
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: { stiffness: 0.2, render: { visible: true } }
        });
        Composite.add(engine.world, mouseConstraint);

        // 偵測誰最靠近底邊
        Events.on(engine, 'afterUpdate', function() {
            let closestDist = Infinity;
            let closestBall = null;

            balls.forEach(ball => {
                const dist = Math.abs(ball.position.x - goalLine);
                if (dist < closestDist) {
                    closestDist = dist;
                    closestBall = ball.label;
                }
            });

            if (closestBall) {
                document.getElementById('winner-display').innerText = 
                    `當前底部加分領先：${closestBall}`;
            }
        });

        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        resetGame();

        // 處理手機縮放
        window.addEventListener('resize', () => {
            render.canvas.width = container.clientWidth;
            render.canvas.height = container.clientHeight;
        });
    </script>
</body>
</html>
