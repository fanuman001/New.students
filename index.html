<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Billiard Glide å°ˆæ¥­æ¨¡æ“¬å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #0f172a; touch-action: none; position: fixed; width: 100%; height: 100%; font-family: sans-serif; }
        #canvas-container { width: 100vw; height: 55vh; position: relative; border-top: 10px solid #451a03; border-bottom: 10px solid #451a03; }
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="w-full bg-slate-900 p-3 text-center">
        <h1 class="text-xl font-black text-emerald-400 tracking-widest">BILLIARD GLIDE</h1>
        <p class="text-[10px] text-slate-400 uppercase">Tactical Simulation Pro</p>
    </div>

    <div id="canvas-container" class="bg-emerald-800"></div>

    <div class="flex-1 w-full bg-slate-900 p-4 text-white shadow-2xl">
        <div id="status" class="bg-emerald-900/50 border border-emerald-500 p-2 rounded text-center text-sm mb-4 font-mono">
            ç­‰å¾…æ“Šçƒ...
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="bg-slate-800 p-2 rounded text-xs">
                <p class="text-red-400 font-bold mb-1">é€²å°æ–¹çƒ: +25</p>
                <p class="text-slate-400">é€²é»‘/æ¯çƒ: +50 / +100</p>
            </div>
            <div class="bg-slate-800 p-2 rounded text-xs">
                <p class="text-yellow-400 font-bold mb-1">æœ€é è¿‘åº•é‚Š: +75</p>
                <p class="text-slate-400">é€²è‡ªå·±çƒ: 0 åˆ†</p>
            </div>
        </div>

        <button onclick="location.reload()" class="w-full bg-emerald-600 active:bg-emerald-700 py-3 rounded-xl font-bold transition-all shadow-lg text-white">
            é‡æ–°é–‹å±€
        </button>
    </div>

    <script>
        const { Engine, Render, Runner, Bodies, Composite, Events, Vector, Body } = Matter;

        const engine = Engine.create();
        engine.gravity.y = 0;

        const container = document.getElementById('canvas-container');
        const W = container.clientWidth;
        const H = container.clientHeight;

        const render = Render.create({
            element: container,
            engine: engine,
            options: {
                width: W,
                height: H,
                wireframes: false,
                background: 'transparent'
            }
        });

        // è‡ªå®šç¾©ç¹ªè£½èƒŒæ™¯ (çƒæ¡Œç´°ç¯€)
        Events.on(render, 'beforeRender', function() {
            const ctx = render.context;
            // ç¹ªè£½æ¡Œå¸ƒ
            ctx.fillStyle = '#065f46';
            ctx.fillRect(0, 0, W, H);
            
            // ç¹ªè£½ç™¼çƒç·š (Head String)
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(W * 0.25, 0);
            ctx.lineTo(W * 0.25, H);
            ctx.stroke();
            ctx.setLineDash([]);

            // ç¹ªè£½è…³é¡†æ˜Ÿåº•ç·šæ¨™è¨˜ (å³å´ç›®æ¨™å€)
            ctx.fillStyle = 'rgba(251, 191, 36, 0.2)';
            ctx.fillRect(W - 40, 0, 40, H);

            // ç¹ªè£½å…­å€‹å£è¢‹
            ctx.fillStyle = '#111';
            const pocketR = 20;
            const pockets = [
                {x: 0, y: 0}, {x: W/2, y: 0}, {x: W, y: 0},
                {x: 0, y: H}, {x: W/2, y: H}, {x: W, y: H}
            ];
            pockets.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, pocketR, 0, Math.PI * 2);
                ctx.fill();
            });
        });

        // æ¡Œé‚Šç¢°æ’é«”
        const wallOpt = { isStatic: true, render: { visible: false } };
        Composite.add(engine.world, [
            Bodies.rectangle(W/2, -10, W, 20, wallOpt),
            Bodies.rectangle(W/2, H+10, W, 20, wallOpt),
            Bodies.rectangle(-10, H/2, 20, H, wallOpt),
            Bodies.rectangle(W+10, H/2, 20, H, wallOpt)
        ]);

        // å»ºç«‹çƒ
        function createBall(x, y, color, label, stroke = '#fff') {
            return Bodies.circle(x, y, 12, {
                restitution: 0.7,
                frictionAir: 0.03,
                render: { fillStyle: color, strokeStyle: stroke, lineWidth: 3 },
                label: label
            });
        }

        let ballList = [
            createBall(W * 0.15, H/2 - 30, '#ef4444', 'AéšŠ'),
            createBall(W * 0.15, H/2 + 30, '#3b82f6', 'BéšŠ'),
            createBall(W * 0.8, H/2, '#111', 'é»‘çƒ', '#fbbf24'),
            createBall(W * 0.8, H/2 - 50, '#f8fafc', 'æ¯çƒ', '#94a3b8')
        ];
        Composite.add(engine.world, ballList);

        // è§¸æ§äº’å‹•é‚è¼¯
        let dragBall = null, startPt = null;

        container.addEventListener('touchstart', (e) => {
            const t = e.touches[0];
            const rect = container.getBoundingClientRect();
            const pt = { x: t.clientX - rect.left, y: t.clientY - rect.top };
            
            ballList.forEach(b => {
                if (Vector.magnitude(Vector.sub(b.position, pt)) < 25) {
                    dragBall = b;
                    startPt = pt;
                }
            });
        });

        container.addEventListener('touchend', (e) => {
            if (!dragBall) return;
            const t = e.changedTouches[0];
            const rect = container.getBoundingClientRect();
            const endPt = { x: t.clientX - rect.left, y: t.clientY - rect.top };
            
            const force = Vector.sub(startPt, endPt);
            Body.applyForce(dragBall, dragBall.position, Vector.mult(force, 0.00005 * dragBall.mass));
            dragBall = null;
        });

        // éŠæˆ²å¾ªç’°ï¼šåµæ¸¬é€²æ´èˆ‡æœ€è¿‘è·é›¢
        Events.on(engine, 'afterUpdate', () => {
            let closest = { name: 'ç„¡', dist: Infinity };
            const pockets = [{x: 0, y: 0}, {x: W/2, y: 0}, {x: W, y: 0}, {x: 0, y: H}, {x: W/2, y: H}, {x: W, y: H}];

            ballList.forEach((b, idx) => {
                // 1. åµæ¸¬é€²æ´ (è·é›¢å£è¢‹å°æ–¼ 20)
                pockets.forEach(p => {
                    if (Vector.magnitude(Vector.sub(b.position, p)) < 22) {
                        // é€™è£¡å¯ä»¥åŠ å…¥åŠ åˆ†é‚è¼¯
                        document.getElementById('status').innerText = `ğŸ’¥ ${b.label} é€²æ´äº†ï¼`;
                        Composite.remove(engine.world, b);
                        ballList.splice(idx, 1);
                    }
                });

                // 2. åµæ¸¬æœ€è¿‘åº•é‚Š (å³é‚Š)
                const d = Math.abs(b.position.x - W);
                if (d < closest.dist) {
                    closest = { name: b.label, dist: d };
                }
            });

            if (ballList.length > 0) {
                const statusLine = document.getElementById('status');
                if (!statusLine.innerText.includes('é€²æ´')) {
                    statusLine.innerText = `ğŸ¯ é ˜å…ˆï¼š${closest.name} (+75åˆ†)`;
                }
            }
        });

        Render.run(render);
        Runner.run(Runner.create(), engine);
    </script>
</body>
</html>

